#!/usr/bin/env ruby

require 'optparse'
require 'hierogloss'

options = { format: 'html', images: false }

OptionParser.new do |opts|
  opts.banner = "Usage: hierogloss [options] files..."

  opts.on("-f", "--format [FORMAT]",
          "Output format (html, bbcode, htlal)",
          "  (defaults to html)") do |format|
    options[:format] = format
  end

  opts.on("-i", "--[no-]images",
          "Use inline images to render hieroglyphs",
          "  (defaults to off)") do |images|
    options[:images] = images
  end
end.parse!

args = { input: 'hierogloss', use_images_for_signs: options[:images] }
if options[:format] == 'html'
  args[:template] =
    File.join(File.dirname(__FILE__), '..', 'data', 'hierogloss.html.erb')
end

doc = Kramdown::Document.new(ARGF.read, args)
puts doc.send("to_#{options[:format]}")
